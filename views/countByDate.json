{"_id":"_design/countByDate","_rev":"10-60e6d632ca9d7c397295876e135d4147","language":"javascript","views":{"countByDate":{"map":"function(doc) \n{\n    var month=new Array(12);\n    month[\"JAN\"]=\"01\";\n    month[\"FEB\"]=\"02\";\n    month[\"MAR\"]=\"03\";\n    month[\"APR\"]=\"04\";\n    month[\"MAY\"]=\"05\";\n    month[\"JUN\"]=\"06\";\n    month[\"JUL\"]=\"07\";\n    month[\"AUG\"]=\"08\";\n    month[\"SEP\"]=\"09\";\n    month[\"OCT\"]=\"10\";\n    month[\"NOV\"]=\"11\";\n    month[\"DEC\"]=\"12\";\n\n    if(doc.Date)\n    {\n        datestr = new Array(3);\n        pieces = doc.Date.split(/\\s+/);\n        \n        // CASE 1: Tue, 19 Mar 2002 12:48:03 -0800\n        // CASE 2: Tue, May 3 2000...\n        // CASE 3: Mon Aug 12 11:32:39 1996\n        // CASE 4: 01 Nov 2002 06:51:39 -0500\n        \n        \n        //CASE 1 & 2\n        if (isNaN(pieces[0]))\n        {        \n            // CASE 2 & 3\n            if (isNaN(pieces[1]))\n            {\n                if ((pieces[2].length == 1) &&(pieces[2].substring(0) != '0'))\n                {\n                    pieces[2] = '0' + pieces[2];\n                }\n                \n                // CASE 3: Mon Aug 12 11:32:39 1996\n                if (pieces[3].length > 4)\n                {\n                    datestr[1] = month[pieces[1].toUpperCase()]; // day\n                    datestr[2] = pieces[2];                      // month\n                    datestr[0] = pieces[4];                      // year\n                }\n                \n                // CASE 2: Tue, May 3 2000\n                else \n                {\n                    datestr[1] = month[pieces[1].toUpperCase()];\n                    datestr[2] = pieces[2];\n                    datestr[0] = pieces[3];\n                }\n            }\n            // CASE 1: Tue, 19 Mar 2002\n            else\n            {\n                // add a zero to the day if it is a single digit with no leading 0\n                // ex: 8 Jul\n                if ((pieces[1].length == 1) &&(pieces[1].substring(0) != '0'))\n                {\n                    pieces[1] = '0' + pieces[1];\n                }\n                datestr[1] = month[pieces[2].toUpperCase()];\n                datestr[2] = pieces[1];\n                datestr[0] = pieces[3];\n            }\n        }\n        // CASE 4: 01 Nov 2002\n        else\n        {\n            if ((pieces[0].length == 1) &&(pieces[0].substring(0) != '0'))\n            {\n                pieces[0] = '0' + pieces[0];\n            }\n\n            datestr[1] = month[pieces[1].toUpperCase()];\n            datestr[2] = pieces[0];\n            datestr[0] = pieces[2];\n        }\n        \n        // handle old school Y2K date issues\n        if (datestr[0] == 100) // about 10 records had a year of \"100\"\n        {\n            datestr[0] = \"2000\";\n        }\n        else if (datestr[0].length == 2) // about 35 records had a two-digit year\n        {\n            if (datestr[0] > 94)\n            {\n                year = parseInt(datestr[0]) + 1900;\n                datestr[0] = year.toString();\n            }\n            else \n            {\n                year = parseInt(datestr[0]) + 2000;\n                datestr[0] = year.toString();\n            }\n        }\n        emit(datestr); \n    }\n}","reduce":"_count"}},"lists":{"countByDate":"function (head, req)    {        start({'headers': {'Content-type':'text/html'}});        send('<html><body><ul>');      var row;      while (row = getRow())      {        send('<li>' + row.key + ':' + row.value + '</li>');      }      send('</ul></body></html>');    }"}}
